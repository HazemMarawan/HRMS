@using HRMS.Resources; 
@{
    ViewBag.Title = "Index";
}
@section css
{
    <link href="~/Content/LTR/assets/css/components/cards/card.css" rel="stylesheet" type="text/css" />
    <link href="~/Content/LTR/plugins/apex/apexcharts.css" rel="stylesheet" type="text/css">
}
<div class="row">
    @if (HRMS.Auth.isA.Employee() || HRMS.Auth.isA.TeamLeader() || HRMS.Auth.isA.TechnicalManager())
    {


        <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12 layout-spacing">
            <div class="widget widget-one_hybrid widget-followers">
                <div class="widget-heading">
                    <div class="w-title">
                        <div class="w-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-users"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                        </div>
                        <div class="">
                            <p class="w-value" id="managerName">-</p>
                            <h5 class="">@HResource.Manager</h5>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
    @if (HRMS.Auth.isA.Employee() || HRMS.Auth.isA.TeamLeader() || HRMS.Auth.isA.TechnicalManager() || HRMS.Auth.isA.BranchAdmin())
    {
        <div class="col-xl-6 col-lg-12 col-md-12 col-sm-12 col-12">
            <div class="row widget-statistic">
                <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 col-12 layout-spacing">
                    <div class="widget widget-one_hybrid widget-followers">
                        <div class="widget-heading">
                            <div class="w-title">
                                <div class="w-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fa fa-bus"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                                </div>
                                <div class="">
                                    <p class="w-value" id="regularCounter">-</p>
                                    <p style="font-weight:bold;font-size:11px;">@HResource.Regular</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 col-12 layout-spacing">
                    <div class="widget widget-one_hybrid widget-followers">
                        <div class="widget-heading">
                            <div class="w-title">
                                <div class="w-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fa fa-bus"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                                </div>
                                <div class="">
                                    <p class="w-value" id="casualCounter">-</p>
                                    <p style="font-weight:bold;font-size:11px;">@HResource.Casual</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 col-12 layout-spacing">
                    <div class="widget widget-one_hybrid widget-referral">
                        <div class="widget-heading">
                            <div class="w-title">
                                <div class="w-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg>
                                </div>
                                <div class="">
                                    <p class="w-value" id="permissionsCounter">-</p>
                                    <p style="font-weight:bold;font-size:11px;">@HResource.Permissions</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 col-12 layout-spacing">
                    <div class="widget widget-one_hybrid widget-engagement">
                        <div class="widget-heading">
                            <div class="w-title">
                                <div class="w-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fa-solid fa-list-check"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>
                                </div>
                                <div class="">
                                    <p class="w-value" id="missionsCounter">-</p>
                                    <p style="font-weight:bold;font-size:11px;">@HResource.Missions</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
    </div>
  
@if (HRMS.Auth.isA.Employee() || HRMS.Auth.isA.TeamLeader() || HRMS.Auth.isA.TechnicalManager() || HRMS.Auth.isA.BranchAdmin() || HRMS.Auth.isA.SuperAdmin())
{
    <div class="row">
        <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 layout-spacing">
            <div class="widget widget-chart-three">
                <div class="widget-heading">
                    <div class="">
                        <h5 class="">@HResource.ProductivityByDate</h5>
                    </div>
                </div>

                <div class="widget-content">
                    <div id="productivityByDate"></div>
                </div>
            </div>
        </div>
        <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 layout-spacing">
            <div class="widget widget-chart-three">
                <div class="widget-heading">
                    <div class="">
                        <h5 class="">@HResource.ProductivityByProject</h5>
                    </div>
                </div>

                <div class="widget-content">
                    <div id="productivityByProject"></div>
                </div>
            </div>
        </div>
    </div>
}
@if(HRMS.Auth.isA.SuperAdmin()) {
    <div class="card">
        <div class="card-header">
            Projects Statistics
        </div>
        <div class="card-body">

            <div class="table-responsive">
                <table id="branchTable" class="table table-striped table-bordered" style="width:100%">
                    <thead>
                        <tr>
                            <th>Project Name</th>
                            <th>MVOH</th>
                            <th>LVOH</th>
                            <th>MVUG</th>
                            <th>LVUG</th>
                            @*<th>Equipment Quantity</th>*@
                            <th></th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>
}



@section scripts{
    <script>
        $(document).ready(function () {

             var datatable = $('#branchTable')
               .DataTable({/* we added this from the other system to have same search and same pagination*/
                   "dom": "<'dt--top-section '<'row'<'col-sm-12 col-md-6 d-flex justify-content-md-start justify-content-center'B><'col-sm-12 col-md-6 d-flex justify-content-md-end justify-content-center mt-md-0 mt-3'f>>>" +
                       "<'table-responsive  'tr>" +
                       "<'dt--bottom-section d-sm-flex justify-content-sm-between text-center'<'dt--pages-count  mb-sm-0 mb-3'i><'dt--pagination'p>>",
                   "buttons": {
                       buttons: [
                           { extend: 'copy', className: 'btn btn-sm' },
                           { extend: 'csv', className: 'btn btn-sm' },
                           { extend: 'excel', className: 'btn btn-sm' },
                           { extend: 'print', className: 'btn btn-sm' }
                       ]
                   },
                   "oLanguage": {
                       "oPaginate": { "sPrevious": 'Perivous', "sNext": 'Next' },
                       "sInfo": "Showing page _PAGE_ of _PAGES_",
                       "sSearch": '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>',
                       "sSearchPlaceholder": "Search...",
                       "sLengthMenu": "Results :  _MENU_",
                   },
                    "processing": true,
                    "serverSide": true,
                    "scrollX": true,
                    "stateSave": false,
                    "lengthChange": false,
                    "dom": 'Bfrtip',

                    "buttons": ['copy', 'excel', 'pdf', 'print'],
                    "pageLength":10,
                    "rowId": 'id',
                    "ajax": {
                        "url": "@Url.Action("Index", "Dashboard")",
                        "type": "POST",
                        "datatype": "json",
                        "dataSrc": "data"
                    },
                    "columns": [
                        {
                            "data": "project_name",
                            "searchable": true
                        },
                        {
                            "data": "mvoh", "searchable": true,
                            fnCreatedCell: function (nTd, sData, oData, iRow, iCol) {
                                var html = "";

                                if (oData.mvoh)
                                    html += "<span class='badge badge-info'><b>Total: </b>" + oData.mvoh + "</span><br>";
                                else
                                    html += "<span class='badge badge-info'><b>Total: </b>-</span><br>";

                                if (oData.mvohSum > 0)
                                    html += "<span class='badge badge-success'><b>Achieved: </b>" + oData.mvohSum.toFixed(2) + "</span><br>";
                                if (oData.mvohSum > 0)
                                   html += "<span class='badge badge-dark'><b>Percentage: </b>" + ((oData.mvohSum / oData.mvoh) * 100).toFixed(1) + "%</span><br>";
                                $(nTd).html("<span class='action-column'>" + html + "</span>");
                            }
                        },
                        {
                            "data": "lvoh", "searchable": true,
                            fnCreatedCell: function (nTd, sData, oData, iRow, iCol) {
                                var html = "";

                                if (oData.lvoh)
                                    html += "<span class='badge badge-info'><b>Total: </b>" + oData.lvoh + "</span><br>";
                                else
                                    html += "<span class='badge badge-info'><b>Total: </b>-</span><br>";

                                if (oData.lvohSum > 0)
                                    html += "<span class='badge badge-success'><b>Achieved: </b>" + oData.lvohSum.toFixed(2) + "</span><br>";
                                if (oData.lvohSum > 0)
                                   html += "<span class='badge badge-dark'><b>Percentage: </b>" + ((oData.lvohSum / oData.lvoh) * 100).toFixed(1) + "%</span><br>";
                                $(nTd).html("<span class='action-column'>" + html + "</span>");
                            }
                        },
                        {
                            "data": "mvug", "searchable": true,
                            fnCreatedCell: function (nTd, sData, oData, iRow, iCol) {
                                var html = "";

                                if (oData.mvug)
                                    html += "<span class='badge badge-info'><b>Total: </b>" + oData.mvug + "</span><br>";
                                else
                                    html += "<span class='badge badge-info'><b>Total: </b>-</span><br>";

                                if (oData.mvugSum > 0)
                                    html += "<span class='badge badge-success'><b>Achieved: </b>" + oData.mvugSum.toFixed(2) + "</span><br>";
                                if (oData.mvugSum > 0)
                                    html += "<span class='badge badge-dark'><b>Percentage: </b>" + ((oData.mvugSum / oData.mvug) * 100).toFixed(1) + "%</span><br>";
                                $(nTd).html("<span class='action-column'>" + html + "</span>");
                            }
                        },
                        {
                            "data": "lvug", "searchable": true,
                            fnCreatedCell: function (nTd, sData, oData, iRow, iCol) {
                                var html = "";

                                if (oData.lvug)
                                    html += "<span class='badge badge-info'><b>Total: </b>" + oData.lvug + "</span><br>";
                                else
                                    html += "<span class='badge badge-info'><b>Total: </b>-</span><br>";

                                if (oData.lvugSum > 0)
                                    html += "<span class='badge badge-success'><b>Achieved: </b>" + oData.lvugSum.toFixed(2) + "</span><br>";
                                if (oData.lvugSum > 0)
                                    html += "<span class='badge badge-dark'><b>Percentage: </b>" + ((oData.lvugSum / oData.lvug) * 100).toFixed(1) + "%</span><br>";
                                $(nTd).html("<span class='action-column'>" + html + "</span>");
                            }
                        },
                        //{
                        //    "data": "equipment_quantity", "searchable": true,
                        //    fnCreatedCell: function (nTd, sData, oData, iRow, iCol) {
                        //        var html = "";

                        //        html += "<span class='badge badge-info'><b>Total: </b>" + oData.equipment_quantity + "</span><br>";
                        //        if (oData.equipment_quantitySum > 0)
                        //            html += "<span class='badge badge-success'><b>Achieved: </b>" + oData.equipment_quantitySum.toFixed(2) + "</span><br>";
                        //        if (oData.equipment_quantitySum > 0)
                        //            html += "<span class='badge badge-dark'><b>Percentage: </b>" + ((oData.equipment_quantitySum / oData.equipment_quantity) * 100).toFixed(1) + "%</span><br>";
                        //        $(nTd).html("<span class='action-column'>" + html + "</span>");
                        //    }
                        //},
                        {
                            "data": "equipment_quantity", "searchable": true,
                            fnCreatedCell: function (nTd, sData, oData, iRow, iCol) {
                                var html = "";

                                html += `<a title="Details" href="/Project/AreasDetails?id=${oData.id}"><i class="fas fa-info-circle"></i></a>`;
                                $(nTd).html("<span class='action-column'>" + html + "</span>");
                            }
                        },
                        
                    ]
                 });

             $.ajax({
            type: "GET",
            url: '@Url.Action("productivityByDate", "Dashboard")',
            contentType: "application/json; charset=utf-8",
            datatype: "json",
                success: function (data) {
                    var options = {
                        chart: {
                            type: 'bar',

                        },
                        theme: {
                            monochrome: {
                                enabled: true,
                                color: '#255aee',
                                shadeTo: 'light',
                                shadeIntensity: 0.65
                            }
                        },
                        fill: {
                            colors: ['#0000FF', '#0000F1', '#0000F2']
                        },
                        series: [{
                            name: 'Hours',
                            data: data.no_of_hours
                        }],
                        xaxis: {
                            categories: data.xAxis,
                        },
                        plotOptions: {
                            bar: {
                                columnWidth: '40%'
                            }
                        }
                    }


                    var productivityByDate = new ApexCharts(
                        document.querySelector("#productivityByDate"),
                    options
                );
                    productivityByDate.render();
            },
            error: function () {
                //alert("Dynamic content load failed.");
            }
            });

         $.ajax({
            type: "GET",
            url: '@Url.Action("productivityByProject", "Dashboard")',
            contentType: "application/json; charset=utf-8",
            datatype: "json",
                success: function (data) {
                    var options = {
                        chart: {
                            type: 'bar',

                        },
                        theme: {
                            monochrome: {
                                enabled: true,
                                color: '#255aee',
                                shadeTo: 'light',
                                shadeIntensity: 0.65
                            }
                        },
                        fill: {
                            colors: ['#0000FF', '#0000F1', '#0000F2']
                        },
                        series: [{
                            name: 'Hours',
                            data: data.no_of_hours
                        }],
                        xaxis: {
                            categories: data.xAxis,
                        },
                        plotOptions: {
                            bar: {
                                columnWidth: '40%'
                            }
                        }
                    }


                    var productivityByProject = new ApexCharts(
                        document.querySelector("#productivityByProject"),
                    options
                );
                    productivityByProject.render();
            },
            error: function () {
                //alert("Dynamic content load failed.");
            }
         });

        $.ajax({
            type: "GET",
            url: '@Url.Action("getDashboardData", "Dashboard")',
            contentType: "application/json; charset=utf-8",
            datatype: "json",
            success: function (data) {
                if (data.dashboardData.Manager) {
                    $("#managerName").text(data.dashboardData.Manager.full_name);
                }
                var isRTL = '@HRMS.Helpers.CultureHelper.IsRighToLeft()';

                if (isRTL == 'True')
                {
                    $("#regularCounter").text(data.dashboardData.RegularVacations + " من " + data.dashboardData.RegularVacationsBalance);
                    $("#casualCounter").text(data.dashboardData.CasualVacations + " من " + data.dashboardData.CasualVacationsBalance);

                    $("#permissionsCounter").text(data.dashboardData.Permissions);

                    $("#missionsCounter").text(data.dashboardData.Missions);
                }
                else
                {
                    $("#regularCounter").text(data.dashboardData.RegularVacations + " of " + data.dashboardData.RegularVacationsBalance);
                    $("#casualCounter").text(data.dashboardData.CasualVacations + " of " + data.dashboardData.CasualVacationsBalance);

                    $("#permissionsCounter").text(data.dashboardData.Permissions);

                    $("#missionsCounter").text(data.dashboardData.Missions);
                }


                    console.log(data);
                },
            error: function () {
                alert("Dynamic content load failed.");
            }
            });
        });

    </script>

}
